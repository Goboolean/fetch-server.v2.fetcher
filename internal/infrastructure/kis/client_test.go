package kis_test

import (
	"context"
	"fmt"
	"strings"
	"testing"
	"time"

	"github.com/stretchr/testify/assert"

	_ "github.com/Goboolean/common/pkg/env"
)





func TestConstructor(t *testing.T) {

	t.Run("Ping", func(t *testing.T) {
		ctx, cancel := context.WithTimeout(context.Background(), time.Second*30)
		defer cancel()

		err := client.Ping(ctx)
		assert.NoError(t, err)
	})

	t.Run("IsMarketOn", func(t *testing.T) {
		if !client.AccessTokenAvailable() {
			t.Skip("Cannot test IsMarketOn without access token")
		}

		ctx, cancel := context.WithTimeout(context.Background(), time.Second*61)
		defer cancel()

		_, err := client.IsMarketOn(ctx)
		assert.NoError(t, err)
	})
}



func TestSubscribe(t *testing.T) {

	const symbol = "005930"

	t.Run("Subscribe", func(t *testing.T) {

		ctx, cancel := context.WithTimeout(context.Background(), time.Second*5)
		defer cancel()

		ch, err := client.Subscribe(ctx, symbol)
		assert.NoError(t, err)

		//if !client.AccessTokenAvailable() {
		//	t.Skip("Cannot test IsMarketOn without access token")
		//}

		//on, err := client.IsMarketOn(ctx)
		//assert.NoError(t, err)

		var received = 0

		loop:
		for {
			select {
			case <-ctx.Done():
				break loop
			case v := <-ch:
				assert.Equal(t, symbol, v.Symbol)
				received++
			}
		}

		t.Logf("received: %d", received)
	})

	t.Run("SubscribeTwice", func(t *testing.T) {
		ctx, cancel := context.WithTimeout(context.Background(), time.Second*5)
		defer cancel()

		_, err := client.Subscribe(ctx, symbol)
		assert.NoError(t, err)
	})
}



func TestSubscribeInRows(t *testing.T) {

	t.Skip("")

	symbols := strings.Split("018680 043360 018670 032750 225570 089970 278990 108380 003000 014820 031510 179530 372800 174880 411080 102710 293780 435380 375500 101930 083660 175330 009580 241520 053980 291230 119500 265560 002170 258610 097780 001680 142210 005180 311390 234300 039440 050890 033170 215090 003010 024830 001720 338220 208850 092300 004720 357250 058110 006730 091590 253450 389020 137950 013720 352700 207760 388800 170920 361390 092460 009470 243840 149300 015020 138580 037460 018880 065690 101490 003650 106520 047810 316140 33637K 179720 001230 007820 367000 419700 003230 337840 098120 009290 016450 100130 104460 014790 121800 098660 090080 093320 046940 053050 100700 183410 014910 044380 383930 211270 004990 001290 310200 018620 058630 045100 297570 109740 052330 065660 266170 314130 225530 101000 00680K 174900 074610 300120 023810 010770 002785 119850 181340 021880 008290 362320 071950 051980 003830 115390 014285 138080 024940 356680 452260 006140 000480 220180 176590 122900 352090 307870 418250 010620 146320 102370 063570 051160 025890 246960 076610 348210 011420 249420 004780 053160 290720 336060 238500 180060 108490 034940 450520 136490 332570 010400 010130 044490 372320 009450 328380 226360 019180 407400 119830 106080 064090 075580 286000 224110 030000 060980 000440 025860 000325 430230 009520 092870 393890 389500 043650 013030 347000 091120 177350 054540 038110 405920 088800 003495 163430 016800 215360 048550 064820 056700 251370 089890 102120 405640 006345 233250 222160 357580 413600 216400 320000 254120 257990 243870 049950 078930 388790 336570 000430 293490 081580 013580 258050 062860 038620 001440 257720 187270 051915 140670 094970 047920 141020 397880 025900 192440 251970 458610 030610 077360 215480 140520 950110 226440 009070 025540 950130 068760 068290 009415 036420 012630 014970 038070 092040 114190 363250 096760 348350 196300 006980 013310 900280 160980 056190 099190 227420 440820 380320 001750 002025 071200 289860 011230 314140 035460 108320 048430 001685 203650 014830 001530 024110 299170 234080 251120 033530 115180 265520 001515 032685 003280 095340 241560 299910 361670 028260 006400 041460 131370 004250 456700 351320 100090 130500 217190 001140 340930 002710 057030 347770 318000 013810 224810 215000 018260 053700 014100 262260 023450 377740 144960 152550 900140 030190 160600 050760 006840 408920 064760 101400 343090 002995 042110 035760 044340 290270 301300 009810 101140 079160 000040 376290 236030 000815 240600 456190 400760 020560 002070 192410 092220 090370 417010 248170 008350 146060 067160 214430 403360 341170 092730 199820 198940 200880 180400 348080 060850 241590 067630 009310 090150 425040 263020 015760 019685 036930 340570 003075 084850 033920 237690 060240 010960 025750 014130 067770 183300 253590 242040 053300 123010 084180 215200 033180 054930 078935 086960 293580 045520 108230 002840 068790 452160 104830 051600 300080 024120 035250 418210 950200 078350 052710 105330 016360 093370 099410 432470 036170 085670 002870 006280 376180 092070 365330 003080 009835 330730 100790 336260 304100 424980 291810 331520 439730 267270 115530 377220 014440 317770 066410 001570 016670 006490 143240 448710 017900 203400 121850 000885 003475 115310 192390 003220 005830 241690 009730 243070 338100 140070 148780 001465 086890 433530 156100 353200 002787 298040 000850 099390 063160 036010 439090 145210 053270 054300 088290 002680 022220 025880 004450 007690 198080 311960 093240 235980 004430 208350 052900 065680 019680 084010 057680 002795 065350 064260 436610 020710 452300 007310 050860 011790 096530 011155 082740 194700 052300 094480 299900 065420 358570 007340 419050 004560 108860 011080 357120 419540 066910 441270 033830 389140 350520 267790 448730 064960 033240 052600 002200 072710 000050 256630 258830 084670 088790 204610 041830 330860 005490 083310 169330 133750 331380 141080 003960 406760 003310 448370 371950 089010 042660 024950 001770 017650 053080 276730 106240 448760 032080 457390 069540 289170 204630 018250 060280 056080 123040 007610 950190 009155 306200 416180 036460 028670 073560 000950 139050 051370 153710 018120 094820 035600 002630 145270 073540 096870 306040 184230 440320 368770 377400 085310 011810 066310 390110 080520 069140 002790 080420 004970 136410 317330 168490 049070 036580 064350 096690 033540 036710 011690 128660 008490 025320 102260 052220 090470 150840 326030 103140 439410 067990 080010 005945 087600 049630 039200 034230 041920 015710 102280 053590 012510 302550 452280 222110 159010 082640 127120 161890 079960 093640 000320 017960 042500 060900 037710 003410 052960 056090 004540 352480 288620 086390 008730 066620 227950 109860 317830 226330 148250 008700 016790 052400 003530 008500 108675 227100 045970 421800 000215 038460 000155 038870 000725 137310 010660 237820 192820 060480 223310 025560 024900 005965 130740 019440 089030 090850 123690 353190 005930 230980 391710 466910 225190 222800 000180 004105 403550 393210 298060 281740 373220 005880 024890 298830 417840 193250 011320 205100 109820 456570 450080 005030 388870 267320 043610 037760 101360 085910 197140 036640 287410 027740 047310 241710 027050 004890 099520 26490K 014580 017800 016590 105630 003925 430700 043340 238490 040300 229000 271980 457940 297890 003780 224760 002310 332370 009160 323990 380540 126640 352770 115610 073110 263690 065710 060590 130660 206650 015260 086040 348150 034310 053210 285130 179900 179290 117730 024810 000540 042000 000145 131180 092200 419080 009460 069510 017670 215600 049720 204620 079940 122350 451760 043100 282880 006370 104700 047040 036890 279060 290690 115160 001755 168360 036180 221800 277810 386580 065510 239610 468510 900250 003720 053060 020400 072870 378850 046070 181710 060540 318160 465320 383310 031310 005820 280360 068400 007120 176750 039240 023600 267250 161580 145020 009180 022100 377450 124500 268280 005440 018500 114840 127980 347740 140660 068240 003580 034020 005390 199800 095190 206950 021650 303360 095270 011200 451220 004920 252500 005110 014680 083650 006220 002100 403490 163730 096350 058450 035420 014190 090410 005300 009830 003120 090355 027970 252990 023960 036530 076080 006380 030200 319400 054210 115450 066130 002700 012790 254160 383800 200670 302920 332290 089790 009300 000545 006660 005960 191600 029960 093520 187660 117670 122310 054630 067010 002220 003470 424760 321550 153460 449020 395400 041520 078590 059100 136540 002600 002210 007370 166090 004985 085620 256940 011040 023900 016920 382840 464440 900310 188260 064520 058860 274400 007700 033560 023790 322180 268600 005090 091440 068330 256150 353590 33626L 060560 217950 226400 425420 002810 251630 001525 014825 083500 014990 043590 005380 054620 095720 083550 200710 078130 294140 026960 002150 053620 001045 036670 003100 455250 429270 005940 065530 072770 129920 399720 024840 066790 064800 254490 361610 035150 010640 004415 094840 053290 016740 004410 225430 046970 002020 039420 025950 241840 137940 047820 039010 173130 03473K 080000 019010 020000 445360 122640 900100 002460 005420 006570 290560 016600 096630 217620 150900 036560 040420 127710 250060 159910 264450 222040 032580 018310 457190 047770 208890 086670 065450 391060 376980 299030 264900 000370 036480 134790 247660 065150 049120 005850 019770 206560 208640 175140 054800 000760 018700 230360 373170 083450 009200 093230 403870 044990 088130 035620 078340 034300 072130 011560 286750 049800 090460 078940 309960 027830 032640 017940 084695 296160 137080 300720 035510 143210 418420 347890 122690 047400 138490 450940 032830 026890 101390 038540 030210 001500 203690 098460 002990 438580 049470 382900 017890 116100 066970 060380 047050 001070 031440 009780 014470 030960 069640 394280 009420 030530 307750 101530 026150 00499K 050120 333430 298020 045300 298690 082850 121600 192080 008830 037350 056730 076340 000720 289010 033130 189980 228340 033230 065370 107590 446150 204320 321260 013520 032300 119610 009680 171010 432720 044180 103660 310870 043910 069080 427950 28513K 434190 035890 003090 140610 008870 138930 195940 003480 066575 004650 134380 110990 213500 412930 085660 101730 000590 004710 018000 123330 005290 001940 009240 182360 074430 317530 017810 041590 262840 034590 036630 000240 105840 036690 210980 293940 420770 00104K 006740 094850 290120 012800 007280 238200 021080 101240 004000 010600 014620 234070 000270 258250 166480 093920 069330 024070 049960 032350 35320K 033340 950160 061970 115440 047560 448900 067000 187870 078600 012330 405000 194480 003200 012210 227840 348950 124560 067370 058220 234100 322970 067730 273060 453340 016100 036830 001260 053610 004380 296640 270660 042370 145720 088280 228670 008970 222080 004365 043260 023770 019660 001210 000670 008770 339770 079810 100030 035000 067310 080160 005360 397030 017390 090350 200780 272290 058530 006910 190650 000520 039840 238120 025820 016610 446070 058430 274090 402420 317870 095570 091970 010140 148930 182400 271830 081660 460860 454750 442310 105550 330590 025770 030520 068930 039830 214450 015360 012620 376930 189690 352940 038010 011150 075130 086450 290660 162300 005389 011785 094170 396690 101330 001067 005305 138040 032190 318410 151860 258540 017000 215100 223220 005745 038060 284740 092440 294870 293480 456490 322310 067170 214390 221840 145995 099220 207940 032860 322510 023760 045060 020180 044780 095660 094940 102460 196700 214610 053030 250930 333050 016880 005950 308700 006920 051630 211050 026910 009970 004150 121440 171120 004700 000210 388720 010955 219550 103590 289220 086900 046440 072990 009150 041960 377460 017370 090435 024880 060310 007110 125210 032560 036800 095910 024060 004360 215790 389260 112610 097230 111870 035200 136480 318660 355690 372290 005160 006060 190510 311320 039860 004960 138610 037950 072470 040160 032960 000105 039560 200130 046210 104200 128540 110020 104620 054780 003555 064480 089600 00781K 097950 082920 203450 093510 457630 363260 317690 049430 900070 001340 086790 142280 002410 003850 005750 039980 187220 001520 004140 032500 007390 005990 090360 063080 005430 112040 458320 285490 045390 042940 025550 210540 001560 900110 288330 114090 153490 439580 455910 318010 051390 097955 377300 341310 139130 065650 066590 041650 298000 247540 000020 218150 008260 092190 432430 005385 097800 140860 041440 002350 025000 232680 323280 454910 347700 033290 027710 344820 003070 019550 099750 036810 413300 126600 071050 001550 006120 237880 007210 002690 244880 060370 068050 216080 023350 060230 006200 003465 000100 448280 245620 003920 067830 032820 272450 000970 045340 265740 044960 248070 306620 054940 053580 004590 000390 021240 347860 282330 010100 002820 048410 023150 066430 155650 290090 340360 238170 444920 115500 424960 221980 012205 396470 900300 035810 071850 025980 208710 006125 080220 340810 103840 040610 041020 088260 049520 198440 065950 000075 222670 128940 217910 001120 003520 290550 365340 067280 010170 103230 126560 041510 315640 222980 010120 462020 372910 200470 317860 009320 033790 023910 043220 112190 149010 263050 065560 307180 194370 044820 002030 143540 215570 085810 298540 200350 036200 123570 031980 238090 071090 053350 000880 290740 026040 122990 100840 393360 214680 024910 154030 228850 321820 311060 002620 011390 036540 058470 011280 032280 014940 331920 048830 357780 011210 014200 214310 003800 097870 054220 452670 000080 094360 102950 115480 065500 255220 001130 212310 000157 119650 162120 338840 069460 430220 241790 282720 010470 272210 038500 025620 143160 381970 012700 007590 044480 044060 355390 123700 279600 083640 070590 000087 130580 148140 005720 084690 396300 282690 035720 284620 425290 004170 271940 122870 169670 950170 453860 066360 353810 448830 290650 092600 080580 011780 18064K 151910 244460 330350 36328K 059270 014710 000070 003240 006260 025870 419270 290520 072950 063440 096040 084110 058970 304840 001000 101680 053950 250000 089860 319660 120110 019570 012320 339950 104040 437780 154040 086220 082210 432320 034120 036190 023160 065170 039490 273640 000490 275630 214180 372170 004910 002380 113810 402490 434480 377030 322780 007980 024850 266470 006405 384470 118000 290670 001040 071460 222420 134580 029460 323410 005610 408900 087260 138360 310210 355150 007720 033250 006390 071840 217500 013000 028080 440790 031860 101670 170900 006800 219130 317850 004840 214320 083420 005740 065130 352910 086520 422040 001820 001795 024720 087010 121060 321370 008775 060260 000230 027040 051905 305090 267290 018290 267980 042700 024800 131220 027580 039290 051380 066900 378340 009540 123410 009190 005070 061250 389470 042670 012280 063760 003030 191420 436530 377480 448780 170790 109960 002720 304360 017480 042520 079950 044450 019590 008110 030720 215380 065060 308080 033200 258790 031820 015230 050960 104480 008600 196450 107640 229640 118990 007160 041910 417790 192250 001250 001380 004800 131760 003380 406820 311690 200580 088390 012160 079650 032790 004370 217820 072020 139670 001065 100660 214260 067390 259630 33637L 246710 039020 246690 003545 037370 121890 377630 283100 163560 446440 346010 415580 016090 134060 004980 067080 368970 016380 175250 225220 226340 011300 424140 002290 051360 093050 060570 096240 005725 351330 133820 020760 144510 025530 049770 039340 029480 048910 058730 002360 063170 004310 084870 187790 261200 084370 084730 090710 097520 039310 059210 001420 069960 430460 337930 089140 178780 003560 007815 126340 002900 147760 248020 005500 348340 088350 950220 322000 218410 035900 010580 446750 043200 001540 253610 071055 189330 067920 439250 054670 019170 013120 089150 091580 042510 286940 015750 059120 107600 010060 053280 001620 404950 042040 205500 251270 460850 357880 126700 055550 334970 361570 052460 001527 357430 114630 123420 417310 043150 123890 900290 03481K 148150 036570 317240 079170 298380 058400 036120 111110 208370 005870 052690 263810 405100 131030 950140 435620 001060 129260 185490 023410 354200 028300 067290 002420 290380 015860 115960 007680 204020 060720 009440 356860 052420 095610 038390 412350 136660 013700 246250 161570 007460 017250 104540 058650 093190 005387 023000 226950 185750 069410 000250 014280 037560 001200 038680 266870 088910 419120 100220 294630 234690 010780 071280 323230 269620 062970 096775 082800 220100 110790 057880 068940 001270 205470 276240 002760 173940 192650 045660 228760 196490 013870 294090 006890 000910 084990 302430 079550 45014K 096610 213420 438220 078520 900120 033050 032680 417860 001390 004080 001275 086060 009770 00279K 206400 001790 336370 089590 419530 122450 189350 078890 007860 140410 128820 079430 007770 000300 012450 183190 289080 001800 418550 294570 029530 033640 054050 009270 195990 004770 259960 120115 080470 006360 034950 004100 001740 099320 208340 007540 217730 365270 011760 051780 000140 053690 073640 186230 120240 094280 023530 001470 241820 089470 417970 039610 129890 126720 373200 303030 002800 037270 230240 131100 323350 396270 377190 365590 309930 111380 073570 084650 015590 229500 011000 012200 074600 066830 007530 214270 048770 365550 091700 041930 073240 091340 082270 264660 369370 000860 032620 013360 003670 009140 900260 277410 000650 117580 225590 178920 000660 014160 021040 071970 005680 011090 016250 114920 263700 026940 307950 038340 244920 147830 075180 445180 046890 002390 021050 075970 003620 263770 033270 450050 267260 004270 035080 002960 204210 023590 438700 227610 351020 111770 012600 048870 388610 046310 011700 413630 263750 030350 45226K 224020 049180 270520 136510 054090 003550 335870 232830 013990 335890 010950 404990 012750 005810 019990 007575 000150 000680 171090 208140 079970 112290 277070 002230 239340 032800 271560 001430 187420 267850 413640 050090 053800 043090 122830 071670 006805 078150 002240 007570 382800 004090 217270 033320 226320 073010 077970 322190 017180 003570 001780 003547 222810 302440 014530 037030 250030 160550 001880 149980 000890 083790 003690 049480 029780 002450 263600 033160 009620 039130 037330 417200 004870 036620 032980 348030 109080 180640 023440 020150 435870 223250 307930 446190 164060 011930 008470 092130 191410 270210 003680 443250 263860 131400 253840 019540 070300 464680 276040 013890 002780 245450 426550 019210 037230 057540 356890 052260 201490 066670 047080 031430 079370 066700 083930 023800 016580 006040 054450 232530 059090 155660 049080 123860 049550 172670 264850 105560 354390 359090 272110 004020 031330 178320 357550 008355 069260 447690 007070 199150 064550 296520 003610 018470 418170 072520 109070 021045 060150 291650 012690 079980 329180 000220 099430 234920 046140 024740 185190 003535 272550 379390 105740 131090 010040 024090 078140 052860 200230 251280 033500 034830 028050 260660 089980 219420 027410 099440 344860 037440 354320 067900 002920 078070 303530 069620 092230 210120 000400 005710 038290 139990 161000 214420 078860 091810 005257 177830 100120 017550 033100 004830 080720 006110 054410 360070 452980 052020 060250 050110 239890 263720 278650 217320 006050 003460 000227 123840 256840 001080 00088K 091990 442770 145990 100250 241770 288980 006880 149950 299660 017040 335810 450410 010280 033310 450140 448740 004545 214150 106190 086980 363280 052670 096770 043710 003350 006090 207490 445970 236200 032940 008250 352820 048530 158430 005690 005250 095500 001020 340440 077500 417180 008060 217480 263540 028100 260930 008370 442130 216050 006620 195500 237750 048470 383220 020120 019175 081150 224060 150440 196170 083470 378800 010240 002320 055490 000640 021820 327610 071320 053450 004490 333620 001450 086460 277880 004440 111710 189860 034730 006340 454640 402340 005670 030790 430690 051490 017510 236340 034810 233990 011070 446540 090430 052770 317400 051500 195870 445090 009410 455310 298050 054920 007330 001840 456440 308170 082660 054950 064290 114810 070960 456040 451700 115570 073190 261780 370090 138070 023460 078020 006580 080530 069730 307280 278280 042420 388050 308100 010820 035290 040910 178600 035610 318020 465770 095700 008040 236810 202960 088980 043370 016710 039570 079000 368600 000120 064240 046390 094800 214870 039740 002140 263800 051910 380440 034220 139480 001630 389030 232140 336040 011370 288490 045510 204270 312610 123750 065440 092590 069920 066980 183490 313760 007660 066570 131290 079190 012860 058850 281820 417500 040350 37550L 297090 37550K 255440 005010 001725 011170 328130 086820 170030 012610 091090 011500 446840 003300 038530 094860 442900 038950 440110 445680 217330 317120 208860 003490 004060 003060 036090 081000 000225 084440 005800 008930 014915 327260 257370 33626K 168330 219750 051900 366030 000500 052790 38380K 114450 159580 092790 005860 001810 002355 042600 131970 008420 065570 114120 299480 032540 119860 092780 376300 089530 054040 064850 004690 010690 036000 161390 220260 263920 086280 108670 032850 137400 012170 037400 003540 400840 039030 418470 011330 027360 014570 053260 446600 140910 357230 217880 078000 334890 073490 046120 348370 004835 025440 007810 009900 049830 033780 036030 331660 402030 142760 120030 001460 019490 093380 189300 101170 010420 000990 246720 199290 015890 006650 02826K 068270 065770 285800 013570 005935 012030 021320 089230 004255 365900 199730 234340 102940 204840 212560 214330 058820 299670 101160 376190 089850 00806K 038880 240810 001510 058610 126880 900270 001360 900340 003160 377330 002880 041190 067570 382480 141000 057050 462520 086710 000700 054180 260870 109610 950210 192400 100590 084680 314930 206640 214370 056360 451800 000810 061040 012340 260970 078160 037070 005320 270870", " ")

	t.Run("SubscribeManyInRows", func(t *testing.T) {
		ctx, cancel := context.WithTimeout(context.Background(), time.Minute)
		defer cancel()

		for i, symbol := range symbols {
			fmt.Print("number: ", i, " symbol: ", symbol, "\n")
			_, err := client.Subscribe(ctx, symbol)
			assert.NoError(t, err)
		}
	})

	t.Run("VerifyResult", func(t *testing.T) {
		ctx, cancel := context.WithTimeout(context.Background(), time.Second * 5)
		defer cancel()

		ch, err := client.Subscribe(ctx)
		assert.NoError(t, err)

		var received = 0

		loop:
		for {
			select {
			case <-ctx.Done():
				break loop
			case <-ch:
				received++
			}
		}

		t.Logf("received: %d", received)
	})
}


func TestSubscribeMany(t *testing.T) {

	t.Skip("")

	symbols := strings.Split("018680 043360 018670 032750 225570 089970 278990 108380 003000 014820 031510 179530 372800 174880 411080 102710 293780 435380 375500 101930 083660 175330 009580 241520 053980 291230 119500 265560 002170 258610 097780 001680 142210 005180 311390 234300 039440 050890 033170 215090 003010 024830 001720 338220 208850 092300 004720 357250 058110 006730 091590 253450 389020 137950 013720 352700 207760 388800 170920 361390 092460 009470 243840 149300 015020 138580 037460 018880 065690 101490 003650 106520 047810 316140 33637K 179720 001230 007820 367000 419700 003230 337840 098120 009290 016450 100130 104460 014790 121800 098660 090080 093320 046940 053050 100700 183410 014910 044380 383930 211270 004990 001290 310200 018620 058630 045100 297570 109740 052330 065660 266170 314130 225530 101000 00680K 174900 074610 300120 023810 010770 002785 119850 181340 021880 008290 362320 071950 051980 003830 115390 014285 138080 024940 356680 452260 006140 000480 220180 176590 122900 352090 307870 418250 010620 146320 102370 063570 051160 025890 246960 076610 348210 011420 249420 004780 053160 290720 336060 238500 180060 108490 034940 450520 136490 332570 010400 010130 044490 372320 009450 328380 226360 019180 407400 119830 106080 064090 075580 286000 224110 030000 060980 000440 025860 000325 430230 009520 092870 393890 389500 043650 013030 347000 091120 177350 054540 038110 405920 088800 003495 163430 016800 215360 048550 064820 056700 251370 089890 102120 405640 006345 233250 222160 357580 413600 216400 320000 254120 257990 243870 049950 078930 388790 336570 000430 293490 081580 013580 258050 062860 038620 001440 257720 187270 051915 140670 094970 047920 141020 397880 025900 192440 251970 458610 030610 077360 215480 140520 950110 226440 009070 025540 950130 068760 068290 009415 036420 012630 014970 038070 092040 114190 363250 096760 348350 196300 006980 013310 900280 160980 056190 099190 227420 440820 380320 001750 002025 071200 289860 011230 314140 035460 108320 048430 001685 203650 014830 001530 024110 299170 234080 251120 033530 115180 265520 001515 032685 003280 095340 241560 299910 361670 028260 006400 041460 131370 004250 456700 351320 100090 130500 217190 001140 340930 002710 057030 347770 318000 013810 224810 215000 018260 053700 014100 262260 023450 377740 144960 152550 900140 030190 160600 050760 006840 408920 064760 101400 343090 002995 042110 035760 044340 290270 301300 009810 101140 079160 000040 376290 236030 000815 240600 456190 400760 020560 002070 192410 092220 090370 417010 248170 008350 146060 067160 214430 403360 341170 092730 199820 198940 200880 180400 348080 060850 241590 067630 009310 090150 425040 263020 015760 019685 036930 340570 003075 084850 033920 237690 060240 010960 025750 014130 067770 183300 253590 242040 053300 123010 084180 215200 033180 054930 078935 086960 293580 045520 108230 002840 068790 452160 104830 051600 300080 024120 035250 418210 950200 078350 052710 105330 016360 093370 099410 432470 036170 085670 002870 006280 376180 092070 365330 003080 009835 330730 100790 336260 304100 424980 291810 331520 439730 267270 115530 377220 014440 317770 066410 001570 016670 006490 143240 448710 017900 203400 121850 000885 003475 115310 192390 003220 005830 241690 009730 243070 338100 140070 148780 001465 086890 433530 156100 353200 002787 298040 000850 099390 063160 036010 439090 145210 053270 054300 088290 002680 022220 025880 004450 007690 198080 311960 093240 235980 004430 208350 052900 065680 019680 084010 057680 002795 065350 064260 436610 020710 452300 007310 050860 011790 096530 011155 082740 194700 052300 094480 299900 065420 358570 007340 419050 004560 108860 011080 357120 419540 066910 441270 033830 389140 350520 267790 448730 064960 033240 052600 002200 072710 000050 256630 258830 084670 088790 204610 041830 330860 005490 083310 169330 133750 331380 141080 003960 406760 003310 448370 371950 089010 042660 024950 001770 017650 053080 276730 106240 448760 032080 457390 069540 289170 204630 018250 060280 056080 123040 007610 950190 009155 306200 416180 036460 028670 073560 000950 139050 051370 153710 018120 094820 035600 002630 145270 073540 096870 306040 184230 440320 368770 377400 085310 011810 066310 390110 080520 069140 002790 080420 004970 136410 317330 168490 049070 036580 064350 096690 033540 036710 011690 128660 008490 025320 102260 052220 090470 150840 326030 103140 439410 067990 080010 005945 087600 049630 039200 034230 041920 015710 102280 053590 012510 302550 452280 222110 159010 082640 127120 161890 079960 093640 000320 017960 042500 060900 037710 003410 052960 056090 004540 352480 288620 086390 008730 066620 227950 109860 317830 226330 148250 008700 016790 052400 003530 008500 108675 227100 045970 421800 000215 038460 000155 038870 000725 137310 010660 237820 192820 060480 223310 025560 024900 005965 130740 019440 089030 090850 123690 353190 005930 230980 391710 466910 225190 222800 000180 004105 403550 393210 298060 281740 373220 005880 024890 298830 417840 193250 011320 205100 109820 456570 450080 005030 388870 267320 043610 037760 101360 085910 197140 036640 287410 027740 047310 241710 027050 004890 099520 26490K 014580 017800 016590 105630 003925 430700 043340 238490 040300 229000 271980 457940 297890 003780 224760 002310 332370 009160 323990 380540 126640 352770 115610 073110 263690 065710 060590 130660 206650 015260 086040 348150 034310 053210 285130 179900 179290 117730 024810 000540 042000 000145 131180 092200 419080 009460 069510 017670 215600 049720 204620 079940 122350 451760 043100 282880 006370 104700 047040 036890 279060 290690 115160 001755 168360 036180 221800 277810 386580 065510 239610 468510 900250 003720 053060 020400 072870 378850 046070 181710 060540 318160 465320 383310 031310 005820 280360 068400 007120 176750 039240 023600 267250 161580 145020 009180 022100 377450 124500 268280 005440 018500 114840 127980 347740 140660 068240 003580 034020 005390 199800 095190 206950 021650 303360 095270 011200 451220 004920 252500 005110 014680 083650 006220 002100 403490 163730 096350 058450 035420 014190 090410 005300 009830 003120 090355 027970 252990 023960 036530 076080 006380 030200 319400 054210 115450 066130 002700 012790 254160 383800 200670 302920 332290 089790 009300 000545 006660 005960 191600 029960 093520 187660 117670 122310 054630 067010 002220 003470 424760 321550 153460 449020 395400 041520 078590 059100 136540 002600 002210 007370 166090 004985 085620 256940 011040 023900 016920 382840 464440 900310 188260 064520 058860 274400 007700 033560 023790 322180 268600 005090 091440 068330 256150 353590 33626L 060560 217950 226400 425420 002810 251630 001525 014825 083500 014990 043590 005380 054620 095720 083550 200710 078130 294140 026960 002150 053620 001045 036670 003100 455250 429270 005940 065530 072770 129920 399720 024840 066790 064800 254490 361610 035150 010640 004415 094840 053290 016740 004410 225430 046970 002020 039420 025950 241840 137940 047820 039010 173130 03473K 080000 019010 020000 445360 122640 900100 002460 005420 006570 290560 016600 096630 217620 150900 036560 040420 127710 250060 159910 264450 222040 032580 018310 457190 047770 208890 086670 065450 391060 376980 299030 264900 000370 036480 134790 247660 065150 049120 005850 019770 206560 208640 175140 054800 000760 018700 230360 373170 083450 009200 093230 403870 044990 088130 035620 078340 034300 072130 011560 286750 049800 090460 078940 309960 027830 032640 017940 084695 296160 137080 300720 035510 143210 418420 347890 122690 047400 138490 450940 032830 026890 101390 038540 030210 001500 203690 098460 002990 438580 049470 382900 017890 116100 066970 060380 047050 001070 031440 009780 014470 030960 069640 394280 009420 030530 307750 101530 026150 00499K 050120 333430 298020 045300 298690 082850 121600 192080 008830 037350 056730 076340 000720 289010 033130 189980 228340 033230 065370 107590 446150 204320 321260 013520 032300 119610 009680 171010 432720 044180 103660 310870 043910 069080 427950 28513K 434190 035890 003090 140610 008870 138930 195940 003480 066575 004650 134380 110990 213500 412930 085660 101730 000590 004710 018000 123330 005290 001940 009240 182360 074430 317530 017810 041590 262840 034590 036630 000240 105840 036690 210980 293940 420770 00104K 006740 094850 290120 012800 007280 238200 021080 101240 004000 010600 014620 234070 000270 258250 166480 093920 069330 024070 049960 032350 35320K 033340 950160 061970 115440 047560 448900 067000 187870 078600 012330 405000 194480 003200 012210 227840 348950 124560 067370 058220 234100 322970 067730 273060 453340 016100 036830 001260 053610 004380 296640 270660 042370 145720 088280 228670 008970 222080 004365 043260 023770 019660 001210 000670 008770 339770 079810 100030 035000 067310 080160 005360 397030 017390 090350 200780 272290 058530 006910 190650 000520 039840 238120 025820 016610 446070 058430 274090 402420 317870 095570 091970 010140 148930 182400 271830 081660 460860 454750 442310 105550 330590 025770 030520 068930 039830 214450 015360 012620 376930 189690 352940 038010 011150 075130 086450 290660 162300 005389 011785 094170 396690 101330 001067 005305 138040 032190 318410 151860 258540 017000 215100 223220 005745 038060 284740 092440 294870 293480 456490 322310 067170 214390 221840 145995 099220 207940 032860 322510 023760 045060 020180 044780 095660 094940 102460 196700 214610 053030 250930 333050 016880 005950 308700 006920 051630 211050 026910 009970 004150 121440 171120 004700 000210 388720 010955 219550 103590 289220 086900 046440 072990 009150 041960 377460 017370 090435 024880 060310 007110 125210 032560 036800 095910 024060 004360 215790 389260 112610 097230 111870 035200 136480 318660 355690 372290 005160 006060 190510 311320 039860 004960 138610 037950 072470 040160 032960 000105 039560 200130 046210 104200 128540 110020 104620 054780 003555 064480 089600 00781K 097950 082920 203450 093510 457630 363260 317690 049430 900070 001340 086790 142280 002410 003850 005750 039980 187220 001520 004140 032500 007390 005990 090360 063080 005430 112040 458320 285490 045390 042940 025550 210540 001560 900110 288330 114090 153490 439580 455910 318010 051390 097955 377300 341310 139130 065650 066590 041650 298000 247540 000020 218150 008260 092190 432430 005385 097800 140860 041440 002350 025000 232680 323280 454910 347700 033290 027710 344820 003070 019550 099750 036810 413300 126600 071050 001550 006120 237880 007210 002690 244880 060370 068050 216080 023350 060230 006200 003465 000100 448280 245620 003920 067830 032820 272450 000970 045340 265740 044960 248070 306620 054940 053580 004590 000390 021240 347860 282330 010100 002820 048410 023150 066430 155650 290090 340360 238170 444920 115500 424960 221980 012205 396470 900300 035810 071850 025980 208710 006125 080220 340810 103840 040610 041020 088260 049520 198440 065950 000075 222670 128940 217910 001120 003520 290550 365340 067280 010170 103230 126560 041510 315640 222980 010120 462020 372910 200470 317860 009320 033790 023910 043220 112190 149010 263050 065560 307180 194370 044820 002030 143540 215570 085810 298540 200350 036200 123570 031980 238090 071090 053350 000880 290740 026040 122990 100840 393360 214680 024910 154030 228850 321820 311060 002620 011390 036540 058470 011280 032280 014940 331920 048830 357780 011210 014200 214310 003800 097870 054220 452670 000080 094360 102950 115480 065500 255220 001130 212310 000157 119650 162120 338840 069460 430220 241790 282720 010470 272210 038500 025620 143160 381970 012700 007590 044480 044060 355390 123700 279600 083640 070590 000087 130580 148140 005720 084690 396300 282690 035720 284620 425290 004170 271940 122870 169670 950170 453860 066360 353810 448830 290650 092600 080580 011780 18064K 151910 244460 330350 36328K 059270 014710 000070 003240 006260 025870 419270 290520 072950 063440 096040 084110 058970 304840 001000 101680 053950 250000 089860 319660 120110 019570 012320 339950 104040 437780 154040 086220 082210 432320 034120 036190 023160 065170 039490 273640 000490 275630 214180 372170 004910 002380 113810 402490 434480 377030 322780 007980 024850 266470 006405 384470 118000 290670 001040 071460 222420 134580 029460 323410 005610 408900 087260 138360 310210 355150 007720 033250 006390 071840 217500 013000 028080 440790 031860 101670 170900 006800 219130 317850 004840 214320 083420 005740 065130 352910 086520 422040 001820 001795 024720 087010 121060 321370 008775 060260 000230 027040 051905 305090 267290 018290 267980 042700 024800 131220 027580 039290 051380 066900 378340 009540 123410 009190 005070 061250 389470 042670 012280 063760 003030 191420 436530 377480 448780 170790 109960 002720 304360 017480 042520 079950 044450 019590 008110 030720 215380 065060 308080 033200 258790 031820 015230 050960 104480 008600 196450 107640 229640 118990 007160 041910 417790 192250 001250 001380 004800 131760 003380 406820 311690 200580 088390 012160 079650 032790 004370 217820 072020 139670 001065 100660 214260 067390 259630 33637L 246710 039020 246690 003545 037370 121890 377630 283100 163560 446440 346010 415580 016090 134060 004980 067080 368970 016380 175250 225220 226340 011300 424140 002290 051360 093050 060570 096240 005725 351330 133820 020760 144510 025530 049770 039340 029480 048910 058730 002360 063170 004310 084870 187790 261200 084370 084730 090710 097520 039310 059210 001420 069960 430460 337930 089140 178780 003560 007815 126340 002900 147760 248020 005500 348340 088350 950220 322000 218410 035900 010580 446750 043200 001540 253610 071055 189330 067920 439250 054670 019170 013120 089150 091580 042510 286940 015750 059120 107600 010060 053280 001620 404950 042040 205500 251270 460850 357880 126700 055550 334970 361570 052460 001527 357430 114630 123420 417310 043150 123890 900290 03481K 148150 036570 317240 079170 298380 058400 036120 111110 208370 005870 052690 263810 405100 131030 950140 435620 001060 129260 185490 023410 354200 028300 067290 002420 290380 015860 115960 007680 204020 060720 009440 356860 052420 095610 038390 412350 136660 013700 246250 161570 007460 017250 104540 058650 093190 005387 023000 226950 185750 069410 000250 014280 037560 001200 038680 266870 088910 419120 100220 294630 234690 010780 071280 323230 269620 062970 096775 082800 220100 110790 057880 068940 001270 205470 276240 002760 173940 192650 045660 228760 196490 013870 294090 006890 000910 084990 302430 079550 45014K 096610 213420 438220 078520 900120 033050 032680 417860 001390 004080 001275 086060 009770 00279K 206400 001790 336370 089590 419530 122450 189350 078890 007860 140410 128820 079430 007770 000300 012450 183190 289080 001800 418550 294570 029530 033640 054050 009270 195990 004770 259960 120115 080470 006360 034950 004100 001740 099320 208340 007540 217730 365270 011760 051780 000140 053690 073640 186230 120240 094280 023530 001470 241820 089470 417970 039610 129890 126720 373200 303030 002800 037270 230240 131100 323350 396270 377190 365590 309930 111380 073570 084650 015590 229500 011000 012200 074600 066830 007530 214270 048770 365550 091700 041930 073240 091340 082270 264660 369370 000860 032620 013360 003670 009140 900260 277410 000650 117580 225590 178920 000660 014160 021040 071970 005680 011090 016250 114920 263700 026940 307950 038340 244920 147830 075180 445180 046890 002390 021050 075970 003620 263770 033270 450050 267260 004270 035080 002960 204210 023590 438700 227610 351020 111770 012600 048870 388610 046310 011700 413630 263750 030350 45226K 224020 049180 270520 136510 054090 003550 335870 232830 013990 335890 010950 404990 012750 005810 019990 007575 000150 000680 171090 208140 079970 112290 277070 002230 239340 032800 271560 001430 187420 267850 413640 050090 053800 043090 122830 071670 006805 078150 002240 007570 382800 004090 217270 033320 226320 073010 077970 322190 017180 003570 001780 003547 222810 302440 014530 037030 250030 160550 001880 149980 000890 083790 003690 049480 029780 002450 263600 033160 009620 039130 037330 417200 004870 036620 032980 348030 109080 180640 023440 020150 435870 223250 307930 446190 164060 011930 008470 092130 191410 270210 003680 443250 263860 131400 253840 019540 070300 464680 276040 013890 002780 245450 426550 019210 037230 057540 356890 052260 201490 066670 047080 031430 079370 066700 083930 023800 016580 006040 054450 232530 059090 155660 049080 123860 049550 172670 264850 105560 354390 359090 272110 004020 031330 178320 357550 008355 069260 447690 007070 199150 064550 296520 003610 018470 418170 072520 109070 021045 060150 291650 012690 079980 329180 000220 099430 234920 046140 024740 185190 003535 272550 379390 105740 131090 010040 024090 078140 052860 200230 251280 033500 034830 028050 260660 089980 219420 027410 099440 344860 037440 354320 067900 002920 078070 303530 069620 092230 210120 000400 005710 038290 139990 161000 214420 078860 091810 005257 177830 100120 017550 033100 004830 080720 006110 054410 360070 452980 052020 060250 050110 239890 263720 278650 217320 006050 003460 000227 123840 256840 001080 00088K 091990 442770 145990 100250 241770 288980 006880 149950 299660 017040 335810 450410 010280 033310 450140 448740 004545 214150 106190 086980 363280 052670 096770 043710 003350 006090 207490 445970 236200 032940 008250 352820 048530 158430 005690 005250 095500 001020 340440 077500 417180 008060 217480 263540 028100 260930 008370 442130 216050 006620 195500 237750 048470 383220 020120 019175 081150 224060 150440 196170 083470 378800 010240 002320 055490 000640 021820 327610 071320 053450 004490 333620 001450 086460 277880 004440 111710 189860 034730 006340 454640 402340 005670 030790 430690 051490 017510 236340 034810 233990 011070 446540 090430 052770 317400 051500 195870 445090 009410 455310 298050 054920 007330 001840 456440 308170 082660 054950 064290 114810 070960 456040 451700 115570 073190 261780 370090 138070 023460 078020 006580 080530 069730 307280 278280 042420 388050 308100 010820 035290 040910 178600 035610 318020 465770 095700 008040 236810 202960 088980 043370 016710 039570 079000 368600 000120 064240 046390 094800 214870 039740 002140 263800 051910 380440 034220 139480 001630 389030 232140 336040 011370 288490 045510 204270 312610 123750 065440 092590 069920 066980 183490 313760 007660 066570 131290 079190 012860 058850 281820 417500 040350 37550L 297090 37550K 255440 005010 001725 011170 328130 086820 170030 012610 091090 011500 446840 003300 038530 094860 442900 038950 440110 445680 217330 317120 208860 003490 004060 003060 036090 081000 000225 084440 005800 008930 014915 327260 257370 33626K 168330 219750 051900 366030 000500 052790 38380K 114450 159580 092790 005860 001810 002355 042600 131970 008420 065570 114120 299480 032540 119860 092780 376300 089530 054040 064850 004690 010690 036000 161390 220260 263920 086280 108670 032850 137400 012170 037400 003540 400840 039030 418470 011330 027360 014570 053260 446600 140910 357230 217880 078000 334890 073490 046120 348370 004835 025440 007810 009900 049830 033780 036030 331660 402030 142760 120030 001460 019490 093380 189300 101170 010420 000990 246720 199290 015890 006650 02826K 068270 065770 285800 013570 005935 012030 021320 089230 004255 365900 199730 234340 102940 204840 212560 214330 058820 299670 101160 376190 089850 00806K 038880 240810 001510 058610 126880 900270 001360 900340 003160 377330 002880 041190 067570 382480 141000 057050 462520 086710 000700 054180 260870 109610 950210 192400 100590 084680 314930 206640 214370 056360 451800 000810 061040 012340 260970 078160 037070 005320 270870", " ")

	t.Run("SubscribeManyInOnce", func(t *testing.T) {
		ctx, cancel := context.WithTimeout(context.Background(), time.Minute)
		defer cancel()

		for i := 0; i < len(symbols); i += 15 {
			end := i + 15
			if end > len(symbols) {
				end = len(symbols)
			}

			var err error
			_, err = client.Subscribe(ctx, symbols[i:end]...)
			assert.NoError(t, err)
		}
	})

	t.Run("VerifyResult", func(t *testing.T) {
		ctx, cancel := context.WithTimeout(context.Background(), time.Second * 5)
		defer cancel()

		ch, err := client.Subscribe(ctx)
		assert.NoError(t, err)

		var received = 0

		loop:
		for {
			select {
			case <-ctx.Done():
				break loop
			case <-ch:
				received++
			}
		}

		t.Logf("received: %d", received)
	})
}